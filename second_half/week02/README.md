# TCP/IP 기반 멀티스레드 채팅 애플리케이션

## 주요 기능

- **TCP/IP 소켓 서버**: `socket` 모듈을 사용한 서버 구현
- **멀티스레드 처리**: `threading` 모듈로 동시 다중 클라이언트 지원
- **입장/퇴장 알림**: 클라이언트 연결/해제 시 전체 브로드캐스트
- **종료 명령어**: `/종료` 입력 시 연결 해제
- **메시지 공유**: 모든 접속자에게 메시지 전달
- **사용자 구별**: `닉네임> 메시지` 형식으로 발신자 표시
- **귓속말 기능**: `@닉네임 메시지` 형식의 특정 사용자 메시지 전송

## 파일 구조

```
week02/
├── main.py          # 서버/클라이언트 통합 실행 파일
└── README.md        # 프로젝트 설명서
```

## 코드 구조

### 주요 함수

- `handle_client(client)`: 클라이언트 메시지 처리 및 브로드캐스트
- `broadcast(message)`: 모든 클라이언트에게 메시지 전송
- `start_server()`: 서버 시작 및 클라이언트 연결 수락
- `start_client()`: 클라이언트 시작 및 서버 연결

### 전역 변수

- `HOST`: 서버 IP 주소 (127.0.0.1)
- `PORT`: 서버 포트 번호 (12345)
- `clients`: 연결된 클라이언트 소켓 리스트
- `nicknames`: 클라이언트 닉네임 리스트
- `client_lock`: 스레드 동기화를 위한 락 객체

## 실행 방법

### 1. 서버 실행
```bash
python main.py
# 입력: 1
```

### 2. 클라이언트 실행
```bash
python main.py
# 입력: 2
# 닉네임 입력
```

### 3. 다중 클라이언트 테스트
여러 터미널에서 클라이언트를 동시에 실행하여 채팅 기능을 테스트할 수 있습니다.

## 사용법

### 일반 메시지
```
안녕하세요!
모두들 잘 지내시나요?
```

### 귓속말
```
@상대닉네임 안녕하세요, 비밀 이야기입니다.
```

### 종료
```
/종료
```

## 메시지 형식

- **일반 메시지**: `닉네임> 메시지 내용`
- **입장 알림**: `닉네임님이 입장하셨습니다.`
- **퇴장 알림**: `닉네임님이 퇴장하셨습니다.`
- **귓속말**: `[귓속말] 발신자닉네임> 메시지 내용`
- **귓속말 전송 확인**: `[귓속말 전송] 수신자닉네임에게: 메시지 내용`

## 기술적 특징

### 소켓 설정
- **프로토콜**: TCP/IP
- **주소 체계**: IPv4 (AF_INET)
- **소켓 타입**: 스트림 소켓 (SOCK_STREAM)
- **포트 재사용**: SO_REUSEADDR 옵션 적용

### 스레드 관리
- **메시지 수신**: 별도 스레드에서 처리
- **메시지 전송**: 별도 스레드에서 처리
- **클라이언트 핸들링**: 각 클라이언트마다 독립적인 스레드
- **스레드 동기화**: `threading.Lock`을 사용한 Race Condition 방지

### 스레드 동기화
- **Race Condition 방지**: `threading.Lock`을 사용한 공유 리소스 보호
- **동기화 영역**: 
  - 클라이언트 추가/제거 (`clients`, `nicknames` 리스트 수정)
  - 귓속말 대상 검색 및 인덱스 접근
  - 브로드캐스트 시 클라이언트 목록 관리

### 예외 처리
- 클라이언트 연결 끊김 상황 대응
- 메시지 전송 실패 시 클라이언트 제거
- 소켓 오류 발생 시 안전한 종료

### 사용 라이브러리
- `socket`: 네트워크 통신
- `threading`: 멀티스레드 처리

## 테스트 시나리오

### 1. 기본 채팅 테스트
1. 서버 실행
2. 클라이언트 3개 동시 실행
3. 각 클라이언트에서 메시지 전송
4. 모든 클라이언트에서 메시지 수신 확인

### 2. 귓속말 테스트
1. 클라이언트 A에서 `@클라이언트B 안녕하세요` 전송
2. 클라이언트 B에서만 메시지 수신 확인
3. 클라이언트 A에서 전송 확인 메시지 수신

### 3. 연결 종료 테스트
1. 클라이언트에서 `/종료` 입력
2. 해당 클라이언트 연결 해제
3. 다른 클라이언트에서 퇴장 알림 수신

### 4. 동시성 테스트
1. 서버 실행
2. 클라이언트 5개 이상 동시 실행
3. 모든 클라이언트에서 동시에 메시지 전송
4. 데이터 일관성 및 Race Condition 방지 확인